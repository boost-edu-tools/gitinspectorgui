# Plan: Creating a Python Sidecar for Tauri Application (`gitinspectorgui`)

## 1. Overall Goal
Make the "Execute Analysis" button in the `gitinspectorgui` (Tauri/React/TypeScript) project functional by reliably calling the Python backend script.

## 2. Current Blocker
The bundled Tauri macOS application cannot consistently execute the Python backend script (`gitinspectorgui/python/gigui/api.py`) using direct calls to system Python interpreters (`uv` or `python3`) due to "No such file or directory (os error 2)" errors. This suggests issues with the bundled app's execution environment, `PATH`, or permissions/restrictions when spawning these processes.

## 3. Proposed Solution: Python Sidecar Executable
Package the Python script and its dependencies into a standalone executable using PyInstaller. This executable will then be bundled as a Tauri "sidecar" (`externalBin`) and called reliably from the Rust backend.

## 4. Reference Material
PyInstaller scripts, `.spec` files, or configurations from the `gitinspectorgui-old` project will be used as a guide for the PyInstaller packaging process.

## 5. Detailed Steps

### Step 5.1: User Action - Provide PyInstaller References
*   **Action:** User to identify and provide paths to the relevant PyInstaller scripts, `.spec` files, or related configuration files within the `gitinspectorgui-old` repository.
*   **Purpose:** Allow Cline to understand the previously successful PyInstaller setup.

### Step 5.2: Cline (AI) - Analyze Old Setup & Adapt
*   **Action:** Cline will read and analyze the provided PyInstaller setup from `gitinspectorgui-old`.
*   **Purpose:** Understand the structure, dependencies, and PyInstaller options used previously.

### Step 5.3: Cline (AI) - Provide PyInstaller Instructions for New Project
*   **Action:** Cline will provide:
    *   Commands to set up the Python environment using `uv` from the project root.
    *   Commands to install `pyinstaller` and dependencies from `pyproject.toml` using uv.
    *   An adapted PyInstaller command or a `.spec` file content tailored for packaging `gitinspectorgui/python/gigui/api.py`.
*   **Target Script:** `gitinspectorgui/python/gigui/api.py`
*   **Key PyInstaller Options (expected):** `--onefile` (to create a single executable), potentially `--noconsole` (though may not be strictly needed for a backend service on macOS), and ensuring `api.py`'s dependencies are correctly bundled.

### Step 5.4: User Action - Package Python Script
*   **Action:** User to execute the virtual environment setup and PyInstaller packaging commands/process as provided by Cline within their local development environment.
*   **Expected Outcome:** A standalone executable file (e.g., `gigui_api_service`) generated by PyInstaller, typically in a `dist` subdirectory.
*   **Feedback to Cline:** User to confirm successful generation of the executable and provide its exact filename and path.

### Step 5.5: Cline (AI) - Integrate Sidecar into Tauri Project
*   **Action (Guidance/File Modifications):**
    1.  **Placement:** Instruct the user to copy the generated Python executable to a suitable location within the Tauri project structure, e.g., `gitinspectorgui/src-tauri/bin/`.
    2.  **`tauri.conf.json` Update:** Modify `gitinspectorgui/src-tauri/tauri.conf.json` to include the new executable in the `tauri > bundle > externalBin` array. For example:
        ```json
        "externalBin": ["bin/gigui_api_service"] 
        ```
        (Path relative to `tauri.conf.json`).
    3.  **`commands.rs` Update:**
        *   Revert the `execute_analysis` function (and `get_settings`, `save_settings`) from using `test.py` or direct `python3` calls.
        *   Rewrite these functions to use `tauri::api::process::Command::new_sidecar("name_from_externalBin")` to call the newly packaged Python executable.
        *   Adapt argument passing (e.g., `"execute_analysis"`, `settings_json`).
        *   Implement logic to handle the asynchronous, event-based output (`CommandEvent::Stdout`, `CommandEvent::Stderr`, `CommandEvent::Terminated`, etc.) from the sidecar process to retrieve results or errors.
*   **Purpose:** Configure Tauri to bundle the Python executable and enable the Rust backend to call it as a sidecar.

### Step 5.6: Build and Test
*   **Action (Cline):** Initiate an `npm run tauri:build` command.
*   **Action (User):**
    *   Once the build is complete, run the bundled `GitInspectorGUI.app`.
    *   Enter a repository path in the settings UI.
    *   Click the "Execute Analysis" button.
    *   Report back to Cline whether the analysis completes successfully and displays results, or if any errors occur.
*   **Purpose:** Verify that the Python sidecar is executed correctly and the application's core functionality is working.

## 6. Contingency
*   If PyInstaller packaging proves difficult or the sidecar still encounters issues, alternative Python bundling/embedding strategies (e.g., PyOxidizer, more complex manual bundling) might need to be explored, but these are significantly more complex.
